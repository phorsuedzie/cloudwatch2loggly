'use strict';

const util = require('util');

const LogEventParser = {
  parse: (logEvent, logGroupName, logStreamName) => {
    var result = {
      logGroupName,
      logStreamName,
      timestamp: new Date(logEvent.timestamp).toISOString(),
    };
    var message = logEvent.message.trim();
    var foreman_match = message.match(/^\d+:\d+:\d+ +(\w+\.\d+) +\| +(.*)$/);
    if (foreman_match) {
      result.foreman_process = foreman_match[1];
      message = foreman_match[2];
    }
    if (message.startsWith("{") && message.endsWith("}")) {
      util._extend(result, JSON.parse(message));
    } else {
      result.message = message;
    }
    return result;
  }
};

module.exports = LogEventParser;
